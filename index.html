<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Mots M√™l√©s - Migration</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 { margin-bottom: 10px; }
    #controls { margin: 15px; }
    select, button {
      padding: 6px 12px;
      font-size: 15px;
      margin-left: 5px;
      cursor: pointer;
    }
    #info {
      margin: 10px;
      font-size: 18px;
      font-weight: bold;
    }
    #timer { color: darkred; margin-left: 20px; }
    #game {
      display: flex;
      gap: 30px;
      align-items: flex-start;
    }
    #grid {
      display: grid;
      grid-template-columns: repeat(20, 30px);
      gap: 2px;
      user-select: none;
    }
    .cell {
      width: 30px;
      height: 30px;
      display: flex;
      justify-content: center;
      align-items: center;
      border: 1px solid #ccc;
      cursor: pointer;
      font-weight: bold;
    }
    .selected { background: yellow; }
    .found { background: lightgreen !important; }
    /* couleurs correction */
    .solution-h { background: lightblue !important; }
    .solution-v { background: lightgreen !important; }
    .solution-d { background: orange !important; color:white; }
    #word-panel { min-width: 300px; }
    #word-list {
      display: flex;
      flex-direction: column;
      flex-wrap: wrap;
      max-height: 600px;
      gap: 5px;
    }
    .word {
      padding: 4px 8px;
      border-radius: 4px;
      background: #f0f0f0;
      display: inline-block;
    }
    .word.found {
      text-decoration: line-through;
      background: lightgreen;
    }
  </style>
</head>
<body>
  <h1>Mots M√™l√©s - Migration</h1>

  <div id="controls">
    <label for="wordCount">Nombre de mots : </label>
    <select id="wordCount">
      <option value="20">20</option>
      <option value="40">40</option>
      <option value="60">60</option>
      <option value="90">90</option>
    </select>
    <button id="startBtn">D√©marrer</button>
    <button id="solutionBtn">Solution</button>
  </div>

  <div id="info" style="display:none;">
    Mots trouv√©s : <span id="foundCount">0</span> / <span id="totalCount">0</span>
    <span id="timer">05:00</span>
  </div>

  <div id="game" style="display:none;">
    <div id="grid"></div>
    <div id="word-panel">
      <h2>Mots √† trouver :</h2>
      <div id="word-list"></div>
    </div>
  </div>

  <script>
    const allWords = [
      "MIGRANTS","MIGRATION","IMMIGRATION","EMIGRATION","EXIL","REFUGIE","ASILE",
      "FRONTIERE","TRANSIT","MOBILITE","DEPLACEMENT","DIASPORA","INTEGRATION","ACCUEIL",
      "EXPULSION","DEPORTATION","NATURALISATION","PASSEPORT","VISA","SEJOUR","TERRITOIRE",
      "ORIGINE","DESTINATION","MINORITE","IDENTITE","RACINES","LANGUE","TRADITION","CULTURE",
      "SOLIDARITE","HUMANITE","ONG","CONVENTION","REFUGE","TRAVERSEE","MER","NAUFRAGE","SAUVETAGE",
      "CAMP","BIDONVILLE","HEBERGEMENT","INCLUSION","ADAPTATION","ASSIMILATION","INTOLERANCE",
      "DISCRIMINATION","RACISME","XENOPHOBIE","CITOYENNETE","NATIONALITE","STATUT","TRAVAIL",
      "OUVRIER","EMPLOYEUR","ARGENT","ECONOMIE","EXODE","FAMILLE","PARENTE","ENFANT","PARCOURS",
      "ROUTE","TRAJET","TRAFIC","PASSEUR","RESEAU","LOI","POLITIQUE","QUOTA","DEBAT","OPINION",
      "CRISE","FLUX","PRESSION","CLIMAT","REINSTALLATION","RETOUR","REINTEGRATION","VOYAGE",
      "SECURITE","FERMETURE","HUMANITAIRE","DEFI","DIVERSITE","ALTERITE","COHESION","TERRE",
      "PEUPLE","NATION","PEUR","ESPOIR","ACCULTURATION","RESILIENCE","MEMOIRE","EXPERIENCE","MONDE"
    ];

    const gridSize = 20;
    const directions = [
      {dr:0, dc:1, type:"h"},   // ‚Üí
      {dr:1, dc:0, type:"v"},   // ‚Üì
      {dr:1, dc:1, type:"d"},   // ‚Üò
      {dr:-1, dc:1, type:"d"}   // ‚Üó
    ];

    let grid, cells, foundCount, timer, timeLeft, words, wordPositions;

    function shuffleArray(array) {
      return array.sort(() => Math.random() - 0.5);
    }

    function placeWord(grid, word) {
      let placed = false, tries = 0;
      while (!placed && tries < 500) {
        tries++;
        const dir = directions[Math.floor(Math.random()*directions.length)];
        const row = Math.floor(Math.random()*gridSize);
        const col = Math.floor(Math.random()*gridSize);
        if (row + dir.dr*word.length >= 0 && row + dir.dr*word.length < gridSize &&
            col + dir.dc*word.length >= 0 && col + dir.dc*word.length < gridSize) {
          let fits = true;
          let positions = [];
          for (let i=0;i<word.length;i++) {
            const r = row + dir.dr*i, c = col + dir.dc*i;
            if (grid[r][c] && grid[r][c] !== word[i]) { fits = false; break; }
            positions.push({r,c});
          }
          if (fits) {
            positions.forEach((p,i) => grid[p.r][p.c] = word[i]);
            wordPositions[word] = {positions:positions, type:dir.type};
            placed = true;
          }
        }
      }
    }

    function generateGrid() {
      grid = Array.from({length: gridSize}, () => Array(gridSize).fill(""));
      wordPositions = {};
      words.forEach(w => placeWord(grid, w.toUpperCase()));
      for (let r=0;r<gridSize;r++){
        for (let c=0;c<gridSize;c++){
          if (!grid[r][c]) grid[r][c] = String.fromCharCode(65+Math.floor(Math.random()*26));
        }
      }
    }

    function renderGrid() {
      const gridContainer = document.getElementById("grid");
      gridContainer.innerHTML = "";
      cells = [];
      grid.forEach((row,r)=>{
        row.forEach((letter,c)=>{
          const div = document.createElement("div");
          div.className="cell";
          div.textContent=letter;
          div.dataset.row = r;
          div.dataset.col = c;
          gridContainer.appendChild(div);
          cells.push(div);
        });
      });
    }

    function renderWordList() {
      const wordListContainer = document.getElementById("word-list");
      wordListContainer.innerHTML = "";
      // tri alphab√©tique
      const sorted = [...words].sort();
      sorted.forEach(w=>{
        const span=document.createElement("span");
        span.className="word";
        span.textContent=w;
        span.id="word-"+w;
        wordListContainer.appendChild(span);
      });
      document.getElementById("totalCount").textContent = words.length;
    }

    function initGame() {
      const count = parseInt(document.getElementById("wordCount").value);
      words = shuffleArray(allWords).slice(0,count);
      generateGrid();
      renderGrid();
      renderWordList();
      foundCount = 0;
      document.getElementById("foundCount").textContent = foundCount;
      clearInterval(timer);
      timeLeft = 5*60;
      timer = setInterval(updateTimer,1000);
      updateTimer();
      setupInteractions();
      document.getElementById("info").style.display="block";
      document.getElementById("game").style.display="flex";
    }

    // Interaction s√©lection
    let isSelecting=false;
    let selection=[];

    function clearSelection() {
      selection.forEach(cell=>cell.classList.remove("selected"));
      selection=[];
    }

    function setupInteractions() {
      cells.forEach(cell=>{
        cell.addEventListener("mousedown",()=>{
          isSelecting=true;
          clearSelection();
          selection.push(cell);
          cell.classList.add("selected");
        });
        cell.addEventListener("mouseenter",()=>{
          if (isSelecting && !selection.includes(cell)){
            selection.push(cell);
            cell.classList.add("selected");
          }
        });
      });

      document.addEventListener("mouseup",()=>{
        if (isSelecting){
          isSelecting=false;
          const word = selection.map(c=>c.textContent).join("");
          const reversed = selection.map(c=>c.textContent).reverse().join("");
          if (words.includes(word) || words.includes(reversed)){
            selection.forEach(c=>c.classList.add("found"));
            const w = document.getElementById("word-"+word) || document.getElementById("word-"+reversed);
            if (w && !w.classList.contains("found")) {
              w.classList.add("found");
              foundCount++;
              document.getElementById("foundCount").textContent = foundCount;
              if (foundCount === words.length) endGame(true);
            }
          } else {
            clearSelection();
          }
        }
      });
    }

    // Chronom√®tre
    function updateTimer(){
      let m = Math.floor(timeLeft/60);
      let s = timeLeft%60;
      document.getElementById("timer").textContent =
        `${m.toString().padStart(2,"0")}:${s.toString().padStart(2,"0")}`;
      if (timeLeft <= 0) {
        endGame(false);
      } else {
        timeLeft--;
      }
    }

    function endGame(won){
      clearInterval(timer);
      const score = Math.round((foundCount / words.length) * 100);
      if (won) {
        alert("üéâ Bravo ! Vous avez trouv√© tous les mots !\n\nScore final : 100%");
      } else {
        alert("‚è±Ô∏è Temps √©coul√© !\nMots trouv√©s : " + foundCount + " / " + words.length +
              "\nScore final : " + score + "%");
      }
    }

    // Bouton D√©marrer
    document.getElementById("startBtn").addEventListener("click", initGame);

    // Bouton Solution avec mot de passe
    document.getElementById("solutionBtn").addEventListener("click",()=>{
      const pwd = prompt("Entrez le mot de passe pour afficher la solution :");
      if (pwd === "123") {
        words.forEach(w=>{
          const data = wordPositions[w];
          if (data) {
            data.positions.forEach(p=>{
              const cell = cells.find(c=>c.dataset.row==p.r && c.dataset.col==p.c);
              if (cell) {
                if (data.type==="h") cell.classList.add("solution-h");
                if (data.type==="v") cell.classList.add("solution-v");
                if (data.type==="d") cell.classList.add("solution-d");
              }
            });
            document.getElementById("word-"+w).style.fontWeight="bold";
          }
        });
      } else {
        alert("‚ùå Mot de passe incorrect !");
      }
    });
  </script>
</body>
</html>
